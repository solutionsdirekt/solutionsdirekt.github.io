<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Self-signed Certificates in Java | Development Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Mit den letzten Java releases (8u241, 11.0.6 und 13.0.2) wurde das Verhalten für self-signed certificates angepasst.">
    <link rel="preload" href="/assets/css/0.styles.3366beeb.css" as="style"><link rel="preload" href="/assets/js/app.9fce4c5b.js" as="script"><link rel="preload" href="/assets/js/14.95cbb687.js" as="script"><link rel="preload" href="/assets/js/7.81758dc8.js" as="script"><link rel="preload" href="/assets/js/23.690d475f.js" as="script"><link rel="prefetch" href="/assets/js/10.7d172329.js"><link rel="prefetch" href="/assets/js/11.858e9aef.js"><link rel="prefetch" href="/assets/js/12.43bda00b.js"><link rel="prefetch" href="/assets/js/13.c720ac72.js"><link rel="prefetch" href="/assets/js/15.24d36dab.js"><link rel="prefetch" href="/assets/js/16.bbe3730a.js"><link rel="prefetch" href="/assets/js/17.9067a803.js"><link rel="prefetch" href="/assets/js/18.a9d54df3.js"><link rel="prefetch" href="/assets/js/19.4d2e4527.js"><link rel="prefetch" href="/assets/js/20.377852dd.js"><link rel="prefetch" href="/assets/js/21.1a5356fb.js"><link rel="prefetch" href="/assets/js/22.2263fda2.js"><link rel="prefetch" href="/assets/js/24.75077c10.js"><link rel="prefetch" href="/assets/js/25.44ad6d96.js"><link rel="prefetch" href="/assets/js/26.c0740a79.js"><link rel="prefetch" href="/assets/js/27.c8c42fe0.js"><link rel="prefetch" href="/assets/js/28.b6b4e667.js"><link rel="prefetch" href="/assets/js/3.5603146a.js"><link rel="prefetch" href="/assets/js/4.f44229da.js"><link rel="prefetch" href="/assets/js/5.323f304f.js"><link rel="prefetch" href="/assets/js/6.be507fb2.js"><link rel="prefetch" href="/assets/js/8.cdea3e40.js"><link rel="prefetch" href="/assets/js/9.c7b91885.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.1bed7082.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3366beeb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section><header id="header"><div class="header-wrapper centered"><div class="title"><a href="/" class="nav-link home-link"><img alt="direkt gruppe" src="/dg-logo.jpg"> <div class="site-name">Development</div></a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/static/aboutus/" class="nav-link">About us</a></li><li class="nav-item"><a href="/static/compliancefactory/" class="nav-link">Compliance Factory</a></li></ul></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link"><img alt="direkt gruppe" src="/dg-logo.jpg"> <div class="site-name">Development</div></a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/static/aboutus/" class="nav-link">About us</a></li><li class="mobile-nav-item"><a href="/static/compliancefactory/" class="nav-link">Compliance Factory</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <section class="tag-bar-wrapper"><div id="tag-bar" class="centered"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="links"><a href="/tag/architecture/" class="nav-link">Architecture</a> <a href="/tag/java/" class="nav-link">Java</a> <a href="/tag/spring-boot/" class="nav-link">Spring Boot</a></div></div></section> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><div class="slide"><div class="slide-background" style="background-image:url(/selfsigned_certs.jpg);"><div class="slide-color"><div class="slide-wrapper centered"><div class="content"><h5>Self-signed Certificates in Java</h5> <p>Mit den letzten Java releases (8u241, 11.0.6 und 13.0.2) wurde das Verhalten für self-signed certificates angepasst.</p> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> <span itemprop="name">Guido</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-06-18T00:00:00.000Z">
      18 June 2020
    </time></div> <!----></div> <!----></div></div></div></div></div> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div itemprop="articleBody" class="content__default"><p>Die Verwendung von self-signed Certificates ist im Bereich Web Development kaum wegzudenken. Gerade für Testsysteme, Regressionstests und nicht zu letzt die lokale Entwicklungsumgebung. Das Generieren der Schlüssel und das entsprechende Signieren lässt sich mittels openssl oder powershell command in wenigen Sekunden erledigen.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>openssl req -x509 -newkey rsa:4096 -keyout key.pem -nodes -out cert.pem -days 365
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>New<span class="token operator">-</span>SelfSignedCertificate <span class="token operator">-</span>Subject <span class="token string">&quot;CN=dev.local&quot;</span> <span class="token operator">-</span>FriendlyName <span class="token string">&quot;Basic Self-Signed Cert&quot;</span> <span class="token operator">-</span>NotAfter <span class="token punctuation">(</span><span class="token namespace">[DateTime]</span>::Now<span class="token punctuation">)</span><span class="token punctuation">.</span>AddYears<span class="token punctuation">(</span>1<span class="token punctuation">)</span> <span class="token operator">-</span>CertStoreLocation <span class="token string">&quot;Cert:\LocalMachine\My&quot;</span> <span class="token operator">-</span>KeyExportPolicy Exportable
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Beide Befehle generieren ein self-signed certificate, welches man für eine Development SSL Konfiguration verwenden kann. Dies funktioniert seit vielen Jahren problemlos. Nun ist jedoch jemand auf die Idee gekommen, dies für nicht mehr ausreichend zu erklären.</p> <p>Mit den letzten Java releases 8u241, 11.0.6 und 13.0.2 wurde eine erweitere Prüfung auf ein Basic Constraint eingefügt. Wenn CA=true nicht gesetzt ist, werden die Zertifikate nicht mehr als Root Zertifikat akzeptiert. Statt dessen heißt es nur:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>TrustAnchor with subject <span class="token string">&quot;CN=dev.local&quot;</span> is not a CA certificate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Damit stellen sich zwei Fragen, zum einen, wie erkennt man das Problem und wie löst man es?</p> <p>Erkennen ist hier relativ einfach. Die einfachste Möglichkeit unter Windows ist wohl die einfache Zertifikat Anzeige, die man üblicherwerweise beim Öffnen von .cer oder .crt Dateien bekommt. Hier kann dann ein schnelles Umbenennen des .pem oder .der in .cer sehr hilfreich sein. Die Anzeige stellt unter Details die Erweiterungen dar. Unter Basic Constraints kann man also sofort sehen, ob der Schalter für CA gesetzt ist, oder eben nicht.</p> <p>Über die Console lässt sich das mit openssl ebenfalls prüfen:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>openssl x509 -in mycert.crt -text -noout
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Der Output ist deutlich länger als hier gezeigt, aber etwa in der Mitte findet man die Informationen zu den Extensions und dem basic Constraint für CA=true</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.
.
.
                    b8:86:e6:19:9c:9c:bf:77:93:14:43:ac:57:9c:e8:
                    8c:44:67
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier:
                69:E8:08:67:32:F5:A2:D0:2A:81:2E:ED:40:1D:9C:D8:20:68:76:A0
            X509v3 Authority Key Identifier:
                keyid:69:E8:08:67:32:F5:A2:D0:2A:81:2E:ED:40:1D:9C:D8:20:68:76:A0

            X509v3 Basic Constraints: critical
                CA:TRUE
    Signature Algorithm: sha256WithRSAEncryption
         4b:7c:89:76:38:1c:f4:16:d1:0c:c0:44:f5:4e:5f:4f:ee:f5:
         47:48:9f:63:1a:f2:fd:5c:80:65:e8:a4:dd:ac:0d:89:2e:ec:
.
.
.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Aber was kann man tun, wenn man den Fehler &quot;TrustAnchor with subject CN=....  is not a CA certificate&quot; in den logs findet? Die kurze Antwort: einfach das Zertifikat neu generieren und das CA=true gleich richtig setzen. Für die Bash ist das relativ einfach:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>openssl req -x509 -newkey rsa:4096 -keyout key.pem -nodes -out cert.pem -days <span class="token number">365</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Dies ist der selbe Befehl, da OpenSSL den Schalter in der Default Konfiguration offenbar schon setzt. Die Powershell macht dies leider nicht ganz so einfach. Der oben gezeigte Befehl generiert das self-signed certificate leider ohne CA=true. Hier muss man manuell noch mal die Extension setzen.</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token variable">$rootextension</span> = <span class="token namespace">[System.Security.Cryptography.X509Certificates.X509BasicConstraintsExtension]</span>::new<span class="token punctuation">(</span><span class="token boolean">$true</span><span class="token punctuation">,</span> <span class="token boolean">$true</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token boolean">$true</span><span class="token punctuation">)</span>
<span class="token variable">$root</span> = New<span class="token operator">-</span>SelfSignedCertificate <span class="token operator">-</span>Subject <span class="token string">&quot;CN=dev.local&quot;</span> <span class="token operator">-</span>FriendlyName <span class="token string">&quot;Self-Signed Root Cert&quot;</span> <span class="token operator">-</span>Extension <span class="token variable">$rootextension</span> <span class="token operator">-</span>NotAfter <span class="token punctuation">(</span><span class="token namespace">[DateTime]</span>::Now<span class="token punctuation">)</span><span class="token punctuation">.</span>AddYears<span class="token punctuation">(</span>1<span class="token punctuation">)</span> <span class="token operator">-</span>CertStoreLocation <span class="token string">&quot;Cert:\LocalMachine\My&quot;</span> <span class="token operator">-</span>KeyExportPolicy Exportable
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Sollten alle Stricke reißen und es muss unbedingt ein CA=false self-signed certificate sein, dann kann man dieses Verhalten auch explizit auf den alten Zustand zurückdrehen.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>-Djdk.security.allowNonCaAnchor<span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Über das Property kann in allen neueren Java Versionen das Verhalten konfiguriert werden.</p></div> <footer></footer></article></div></div> <div class="mainFooter" data-v-957f1fc4><div class="mainFooter-wrapper centered" data-v-957f1fc4><div class="MainFooterNav-second" data-v-957f1fc4><div class="sec-footerNavFirst" data-v-957f1fc4><p class="headline" data-v-957f1fc4><b data-v-957f1fc4>Contact</b></p> <p data-v-957f1fc4>direkt gruppe GmbH<br data-v-957f1fc4>Tel.: <a href="tel:040881550" data-v-957f1fc4>+49 04 88155-0</a><br data-v-957f1fc4><a href="mailto:info@direkt-gruppe.de" data-v-957f1fc4>info@direkt-gruppe.de</a></p></div> <div class="sec-footerNavSecond" data-v-957f1fc4><p class="headline" data-v-957f1fc4><b data-v-957f1fc4>Hamburg</b></p> <p data-v-957f1fc4>Griegstraße 75, H. 26<br data-v-957f1fc4>22763 Hamburg<br data-v-957f1fc4><a href="https://goo.gl/maps/DwqBiQsFYA1FFFqE8" target="_blank" rel="noopener" data-v-957f1fc4>Find us</a></p></div> <div class="sec-footerNavThird" data-v-957f1fc4><p class="headline" data-v-957f1fc4><b data-v-957f1fc4>Cologne</b></p> <p data-v-957f1fc4>Im Mediapark 6b<br data-v-957f1fc4>50670 Cologne<br data-v-957f1fc4><a href="https://goo.gl/maps/HXsxMWudPimcypCA7" target="_blank" rel="noopener" data-v-957f1fc4>Find us</a></p></div> <div class="sec-footerNavFourth" data-v-957f1fc4><p class="headline" data-v-957f1fc4><b data-v-957f1fc4>Munich</b></p> <p data-v-957f1fc4>Landbaubogen 1<br data-v-957f1fc4>81373 Munich<br data-v-957f1fc4><a href="https://goo.gl/maps/bKpHR6LADAX8zq3a6" target="_blank" rel="noopener" data-v-957f1fc4>Find us</a></p></div> <div class="sec-footerNavFifth" data-v-957f1fc4><p class="headline" data-v-957f1fc4><b data-v-957f1fc4>Paderborn</b></p> <p data-v-957f1fc4>Technologiepark 9<br data-v-957f1fc4>33100 Paderborn<br data-v-957f1fc4><a href="https://goo.gl/maps/N9iehM63fn7zniYx9" target="_blank" rel="noopener" data-v-957f1fc4>Find us</a></p></div></div> <div class="imprint-links" data-v-957f1fc4><a href="https://www.direkt-gruppe.de/impressum/" target="_blank" data-v-957f1fc4>Impressum</a> |
      <a href="https://www.direkt-gruppe.de/datenschutz/" target="_blank" data-v-957f1fc4>Datenschutz</a> |
      <a href="/static/privacy_policy/en/" class="nav-link" data-v-957f1fc4>Privacy Policy</a></div></div></div> <footer class="footer" data-v-12023167><div class="footer-wrapper centered" data-v-12023167><div class="footer-left-wrap" data-v-12023167><ul class="copyright" data-v-12023167><li class="copyright-item" data-v-12023167>
          Copyright © 2020 direkt gruppe GmbH
        </li></ul></div> <div class="footer-right-wrap" data-v-12023167><ul class="contact" data-v-12023167><li class="contact-item" data-v-12023167><a href="https://www.facebook.com/direktgruppe" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-12023167><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook" data-v-12023167><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" data-v-12023167></path></svg>
            
            </a></li><li class="contact-item" data-v-12023167><a href="https://www.instagram.com/direktgruppe/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-12023167><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram" data-v-12023167><rect x="2" y="2" width="20" height="20" rx="5" ry="5" data-v-12023167></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" data-v-12023167></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5" data-v-12023167></line></svg>
            
            </a></li><li class="contact-item" data-v-12023167><a href="https://www.linkedin.com/company/direkt-gruppe-gmbh/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-12023167><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin" data-v-12023167><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" data-v-12023167></path><rect x="2" y="9" width="4" height="12" data-v-12023167></rect><circle cx="4" cy="4" r="2" data-v-12023167></circle></svg>
            
            </a></li><li class="contact-item" data-v-12023167><a href="https://twitter.com/direkt_gruppe" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-12023167><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-12023167><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-12023167></path></svg>
            
            </a></li></ul></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9fce4c5b.js" defer></script><script src="/assets/js/14.95cbb687.js" defer></script><script src="/assets/js/7.81758dc8.js" defer></script><script src="/assets/js/23.690d475f.js" defer></script>
  </body>
</html>
